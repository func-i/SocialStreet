<% broadcast "/chat_rooms/#{@chat_room.id}" do %>
  var $chatRoom = $('#chat_<%= @chat_room.id%>');
  if( $chatRoom.find('.user-<%= current_user.id %>').length < 1 && $chatRoom.find('#message_user_id').val() != <%= current_user.id %>) {
  $chatRoom.find('.user-holder').prepend('<%= escape_javascript(render("user", :user => current_user)) %>');
  setupTipsy();
  }
  var $count = $chatRoom.find('.user-count');
  var $minCount = $('#chat_room_placeholder_' + <%= @chat_room.id %>).find('.user-count');
  var count = parseInt($count.text(),10);

  // update the number of users in the chat bar and chat room titles.
  $count.text(count + 1);
  $minCount.text(count + 1);

  if(count > 0) {
  $chatRoom.find('.chat-user-list-container').addClass('container');
  }

  if(count > 6) {
  $chatRoom.find('.chat-user-list').width(count * 37);
  $chatRoom.find('.chat-user-list-container').height(50);
  $chatRoom.find('.chat-user-list-container').addClass('scroll-pane');
  initializeScrollPanes();
  }
<% end %>
