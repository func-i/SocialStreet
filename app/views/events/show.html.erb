<% can_edit = @event.can_edit?(current_user) %>

<div id="show_event_details" class="x-small-box y-small-box position-y-top position-x-left drop-shadow">
  <%= form_for @event, :method=>'put', :remote => true, :html => {:id=>"event_edit_form"} do |form|%>
    <div class="result">
      <div class="result-text">
        <div class="result-image">
          <%= image_tag(url_for_event_image(@event))%>
        </div>
        <div class="result-title">
          <span id="result_title_text">
            <%= truncate_html(@event.title, :length => (can_edit ? 36 : 50)) %>
          </span>
          <% if can_edit %>
            <%= link_to "...Edit Title", '#', :id=>'edit_event_title_link' %>
            <%= form.text_field :name, :id=> "edit_event_title_field", :class=>"hidden", :style=>"width:270px;" %>
          <% end %>
        </div>
        <div class="result-date">
          <%= @event.date_range_as_sentence %>
        </div>
        <div class="result-tags">
          Tags: <%= truncate_html(@event.event_keywords_as_sentence, :length => 35) %>
        </div>
      </div>

      <div class="result-description">
        <% if can_edit %>
          <%= link_to ((@event.description && @event.description.length > 0) ? "Edit description..." : "Add Description..."), "#", :id => 'edit_event_description_link' %>
          <%= form.text_area :description, :id=> "edit_event_description_field", :class=>"hidden", :style=>"width:360px;height:70px;" %>
        <% end %>
        <span id="result_description_text">
          <%= @event.description %>
        </span>
      </div>
    </div>
  <% end %>
</div>

<div id="show_view" class="<%="hidden" if params[:invite]%>">
  <div class="x-small-box y-medium-box position-y-middle position-x-left drop-shadow expand-height">
    <%= form_for [@event, @comment], :remote => true, :html => {:id => "event_wall_form"} do |form| %>
      <div id="event_wall_text_field_holder">
        <%= form.text_area :body, :id => "event_wall_text_field", :placeholder => "Leave a Message", :rows => 1-%>
      </div>
    <% end %>
    <div id="event_wall" class="scroll-pane" style="height: 100%; overflow: auto;">
      <%@comments.each do |comment|%>
        <%= render :partial => 'comments/create.html', :locals => {:comment => comment} %>
      <% end %>
    </div>
  </div>

  <div class="position-y-top position-x-center">
    <% if can_edit %>
      <div>
        <%= link_to "Edit StreetMeet...", edit_event_path(@event), :id=>"edit_event_link" %>
        <%= link_to "Cancel", [@event], :method=>'delete', :confirm => 'Are you sure you want to cancel this StreetMeet?', :id=>"destroy_event_link" %>
      </div>
    <% end %>
    <div id="join_btn_holder">
      <% if @event.canceled %>
        <div id="event_canceled_btn">
          Canceled
        </div>
      <% else %>
        <%=render(:partial => 'rsvp_buttons', :locals => {:event => @event})%>
      <% end %>
    </div>

    <div id="show_attendees_holder" class="drop-shadow">
      <div id="show_attendees_title">
        <%= "#{pluralize @event.number_of_attendees, 'Person'} Attending" %>
      </div>
      <div id="show_attendees_list_holder">
        <ul id="show_attendees_list">
          <%@event.event_rsvps.attending.each do |attendee|%>
            <li class="show-attendee-holder">
              <%=avatar(attendee.user, :size => "55x55", :class=> "drop-shadow")%>
              <span class="attendee-name hidden">
                <%=attendee.user.name%>
              </span>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>

<div id="invitation_view" class="<%="hidden" unless params[:invite] %>">
  <%= render :partial => 'invitations/index.html', :locals => {:event => @event, :user_list => @invitation_user_connections} %>
</div>

<%= hidden_field_tag 'lat', @event.location.latitude %>
<%= hidden_field_tag 'lng', @event.location.longitude %>
<%= hidden_field_tag 'location_text', @event.location.text %>
<%= hidden_field_tag 'address', @event.location.short_address_as_sentence %>

<%= javascript_include_tag 'infobubble', "site_specific/show_event"%>
