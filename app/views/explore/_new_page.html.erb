<script type='text/javascript'>
  if(($('#explore-id').length <= 0 || !$('#explore-id').val() || $('#explore-id').val() == <%=@explore_id%>) )
  {
    $('#events-offset').val('<%=@events_offset%>')
    $('#messages-offset').val('<%=@messages_offset%>')
    $('#filter-level').val('<%=@filter_level%>')

    $('#action-list').append(
    '<%= escape_javascript render("results", :searchable_results => (@searchables || []))%>'
  );

<% if @filter_level && (!params[:view].eql?("map") || (false && @searchable_total_count < ExploreController.MORE_RESULTS_LIMIT))%>
      if($('#end-of-results-message').data('closed') != true){
        $('#end-of-results-message').show();
      }
<% end %>

<% if !@similar_results.blank?() %>
      $('#more-results-message').show();
      $('#similar-results-list').append('<%= escape_javascript(render('results', :searchable_results => @similar_results)) %>');
<% end %>

    var myMarkerManager = getMarkerManager();
    //Place pins on map
<% (@searchables || []).each do |searchable| %>
  <% if searchable.geo_located? %>
        myMarkerManager.createMarker(new google.maps.LatLng(<%= searchable.location.latitude %>, <%= searchable.location.longitude %>), <%= searchable.id -%>,null,'<%= searchable.location_address_for_explore -%>');
  <% end %>
<% end %>

<% (@similar_results || []).each do |searchable| %>
  <% if searchable.geo_located? %>
        myMarkerManager.createMarker(new google.maps.LatLng(<%= searchable.location.latitude %>, <%= searchable.location.longitude %>), <%= searchable.id -%>,null,'<%= searchable.location_address_for_explore -%>');
  <% end %>
<% end %>

    //Draw all the markers
    myMarkerManager.placeAllMarkers();

<% if @searchables && @similar_results %>
      //This is the handover from searchables to similar
      getExplorePageless().reset(
      {
        totalPage: <%=  @num_pages %>,
        currentPage: 1
      });
<% end %>
  }
  else{
    console.log('EXPLORE ID failure:  + <%=@explore_id.to_s %>');
  }

</script>