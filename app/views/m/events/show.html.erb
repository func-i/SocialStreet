
<div data-role="page" data-theme="a" id="event_main">
  <div data-role="header" data-position="inline">
    <%= link_to "Home", '/m', {'data-role' => 'button', 'data-theme' => 'a', 'data-position' => 'inline'}%>
    <h1><%=link_to "SocialStreet", '/m'%></h1>
    <% if @event.can_edit?(current_user) %>
      <%= link_to 'Edit', edit_m_event_path(@event), {'data-theme' => 'a', 'data-ajax' => false}%>
    <% end %>
  </div>

  <div data-role="content" data-theme="c">
    <%= image_tag(url_for_event_image(@event), :size => "80x80", :class => "avatar") %>
    <span id="event_title"><%= @event.title %></span>

    <div data-role="fieldcontain" style="font-size: 18px">
      <span id="event_address"><%= address_for(@event.location)%></span>
      <span style="float: right; font-size: 14px" id="map_link"><%= link_to "See on Map", "http://maps.google.com/maps?q=#{address_for(@event.location)}" %></span>
    </div>

    <div data-role="fieldcontain" style="font-size: 14px"><%= @event.date_range_as_sentence %> </div>

    <div data-role ="fieldcontain">

      <fieldset class="ui-grid-a">
        <%  if(@rsvp && EventRsvp.statuses[:attending] == @rsvp.status) %>
          <div id="attending-button"class="ui-block-a"><%= link_to "Attending", [:edit, :m, @event, :event_rsvp], {'data-role' => 'button', 'data-theme' => 'g', 'data-ajax' => false} %></div>
        <% else %>
          <div class="ui-block-a"><%= link_to "Attend", [:new, :m, @event, :event_rsvp], {'data-role' => 'button', 'data-theme' => 'e', 'data-ajax' => false} %></div>
        <% end %>

        <div class="ui-block-b"><%= link_to "Invite People", [:new, :m, @event, :invitation], {'data-role' => 'button', 'data-theme' => 'b'} %></div>
      </fieldset>

    </div>

    <% unless @event.description.blank? %>
      <div data-role="fieldcontain" id="event_details">
        <%= @event.description %>
      </div>
    <% end %>

    <% if @event && @event.can_edit?(current_user) %>
      <div data-role="fieldcontain">
        <%= link_to "Cancel Event", [:m, @event], {:confirm => 'Are you sure?', :method => 'delete', "data-role" => "button", "data-theme" => "f"} %>
      </div>
    <% end %>


    <%= form_for [:m, @event, @comment], :remote => true, :html => {:id => "event_wall_form", "data-ajax" => "false"} do |form| %>
      <div data-role="fieldcontain">
        <%= form.text_area :body, :placeholder => " Leave a Message",  "data-theme" => "d"%>
        <!--textarea cols="40" rows="8" name="textarea" placeholder="Leave a Comment..." data-theme="d"></textarea>
        <div style="float:right; margin: 3px"><%= link_to "#{@event.comments.count} Comments" %> </div-->
      </div>
    <% end %>

    <div id="event_wall">
      <%@comments.each do |comment|%>
        <%= render :partial => 'm/comments/create.html', :locals => {:comment => comment} %>
      <% end %>
      
    </div>

<%#*<div data-role="fieldcontain" id="event_details">%>
<%#=@event.description if !@event.description.empty?%>
<%#*</div>%>
  </div>
</div>

<script type="text/javascript">
  $('#event_wall_form textarea').live('keydown', function(e){
    if(e.keyCode == 13) {
      $('#event_wall_form').submit();
      $(this).val('');
      $(this).blur();
    }
  });
</script>