<style>
  .user.selected {
    background-color: #DDD;
  }
  .user-list {   
    /*overflow: scroll;*/
  }
  .selected-list {    
    /*overflow: scroll;*/
  }

  .remove-btn {
    display: none;
  }
  .selected-list-administrators .remove-btn {
    display: block;    
  }
</style>

<div class="form-holder">
  <div class="row">
    <form action="" method="GET">
      <input type="text" class="search-field text text1" placeholder="Enter a friend's name" />
    </form>
  </div>
</div>
<div class="users-holder">
  <div class="users-list">
    <div class="ul1 user-list">
      <ul id="administrator-user-list">
        <% @users.each do |user| %>
          <%= render 'administrators/user', :user => user, :pre_existing => user.administrator? %>
        <% end %>
      </ul>
    </div>
  </div>
</div>

<script type='text/javascript'>
  var searchURL = '<%= connections_path %>';
  var timeout = null;

  var administratorPageless = null;

  function makeAdministratorPageless(){
    var myScroller = get_iScroller('modal_sidebar_scroll');
    
    administratorPageless = new Pageless({
      container: '#empty_modal_sidebar .content',
      totalPages: <%= @num_pages_administrators -%>,
      currentPage: 1,
      url: '<%= new_event_administrator_path(@event) %>',
      parameterFunction: administratorParamFunction,
      iScroller: myScroller
    });
    administratorPageless.start();

    function administratorParamFunction(){
      return $('form.search-params-administrators').serializeObject();
    }
  }

  function getAdministratorPageless(){
    return administratorPageless;
  }

  $(function() {
    makeAdministratorPageless();
    
    var $selectedList = $('.selected-list-administrators');
    var $administratorCount = $('.administrator-count');

    var $userList = $('.user-list');
    var lastQuery = '';
    
    $('.user-list .user').die();
    $('.user-list .user').live('click', function(e) {
      var $this = $(this);
      var userId = $this.data('user-id');
      // make sure it's removeable before removing the invite
      if ($this.hasClass('selected') && !$this.hasClass('cannot-remove')) {
        $this.removeClass('selected');
        $selectedList.find('.user[data-user-id="'+userId+'"]').remove();
        $administratorCount.text(parseInt($administratorCount.text()) - 1)
      } else if (!$this.hasClass('selected')) {
        $this.addClass('selected');
        $selectedList.prepend($this.clone());
        $administratorCount.text(parseInt($administratorCount.text()) + 1)
      }
    });
    // Need to use .live() b/c elements in selected-list are dynamically added
    // So they may not be there at DOM ready time
    $('.selected-list-administrators .user .remove-btn').die();
    $('.selected-list-administrators .user .remove-btn').live('click', function(e) {
      var $user = $(this).closest('.user');
      var userId = $user.data('user-id');
      $user.remove();
      $userList.find('.user[data-user-id="'+userId+'"]').removeClass('selected');

      $administratorCount.text(parseInt($administratorCount.text()) - 1)
      return false;
    });
  });

  function isEmail(string) {
    var reg = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
    return reg.test(string);
  }
</script>
